#!/bin/bash
# Maven wrapper script that ensures Java 21 is used
# This prevents compilation errors with newer Java versions

# Find and set Java 21
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS
    JAVA_21_HOME=$(/usr/libexec/java_home -v 21 2>/dev/null)
    if [ -z "$JAVA_21_HOME" ]; then
        echo "âŒ Error: Java 21 not found!"
        echo "   Install Amazon Corretto 21 from: https://aws.amazon.com/corretto/"
        exit 1
    fi
    export JAVA_HOME="$JAVA_21_HOME"
elif command -v update-alternatives &>/dev/null; then
    # Linux with update-alternatives
    JAVA_21_HOME=$(update-alternatives --list java | grep java-21 | head -n1 | sed 's|/bin/java||')
    if [ -n "$JAVA_21_HOME" ]; then
        export JAVA_HOME="$JAVA_21_HOME"
    fi
fi

# Execute Maven with all arguments
exec mvn "$@"
