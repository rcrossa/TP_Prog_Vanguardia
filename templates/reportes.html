{% extends "base.html" %}

{% block title %}Reportes y Analytics - Sistema de Reservas{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1><i class="fas fa-chart-bar me-2"></i>Reportes y Analytics</h1>
            <button class="btn btn-primary">
                <i class="fas fa-download me-1"></i>Exportar
            </button>
        </div>
    </div>
</div>

<div class="card border-0 shadow-sm">
    <div class="card-body">
        <div class="text-center py-5">
            <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
            <h4>Reportes y Analytics</h4>
            <p class="text-muted">Funcionalidad conectada con microservicio Java...</p>
            <p class="text-muted">
                <small>Esta p√°gina mostrar√° reportes generados por el servicio Java</small>
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// üîí SEGURIDAD PRE-RENDER: Aplicar clase admin INMEDIATAMENTE
(function() {
    try {
        const userStr = localStorage.getItem('user');
        if (userStr) {
            const user = JSON.parse(userStr);
            if (user && user.is_admin === true) {
                document.body.classList.add('is-admin');
            } else {
                document.body.classList.remove('is-admin');
            }
        } else {
            document.body.classList.remove('is-admin');
        }
    } catch (e) {
        console.error('Error al verificar rol de admin:', e);
        document.body.classList.remove('is-admin');
    }
})();

document.addEventListener('DOMContentLoaded', function() {
    // Esperar a que el AuthManager est√© completamente inicializado
    const checkAuth = () => {
        if (!window.authManager) {
            setTimeout(checkAuth, 100);
            return;
        }
        
        // Verificar que el usuario est√© autenticado
        if (!window.authManager.isAuthenticated()) {
            window.location.href = '/login';
            return;
        }
        
        // Verificar permisos de admin
        const user = window.authManager.getUser();
        if (!user || !user.is_admin) {
            alert('Acceso denegado. Solo los administradores pueden acceder a esta secci√≥n.');
            window.location.href = '/';
            return;
        }
        
        // Si todo est√° bien, cargar reportes
        // Aqu√≠ ir√≠a el c√≥digo espec√≠fico para cargar reportes
    };
    
    // Iniciar verificaci√≥n
    checkAuth();
});
</script>
{% endblock %}